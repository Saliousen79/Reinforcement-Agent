<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Data Test</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a2e;
            color: #fff;
        }
        .success { color: #69db7c; }
        .error { color: #ff6b6b; }
        .info { color: #4dabf7; }
        pre {
            background: #0f0f1a;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #333;
        }
        h1 { color: #4dabf7; }
        h2 { color: #ffd43b; margin-top: 30px; }
        button {
            background: #6c63ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover { background: #5a52d5; }
    </style>
</head>
<body>
    <h1>üìä Dashboard Data Test</h1>

    <div id="status" class="info">Teste Verbindung...</div>

    <h2>1. Aktueller Pfad</h2>
    <pre id="paths"></pre>

    <h2>2. JSON Daten Test</h2>
    <button onclick="testDataLoad()">üîÑ JSON neu laden</button>
    <pre id="data-result">Klicke auf den Button...</pre>

    <h2>3. Dateizugriff Test</h2>
    <pre id="file-result">Wird getestet...</pre>

    <h2>4. Quick Links</h2>
    <button onclick="window.location.href='index.html'">‚Üí Zum Dashboard</button>
    <button onclick="window.location.href='../visualization/index.html'">‚Üí Zur Visualisierung</button>

    <script>
        // Zeige Pfade
        document.getElementById('paths').textContent = `
URL: ${window.location.href}
Origin: ${window.location.origin}
Pathname: ${window.location.pathname}
        `.trim();

        // Test Datenzugriff
        async function testDataLoad() {
            const resultDiv = document.getElementById('data-result');
            const statusDiv = document.getElementById('status');

            try {
                statusDiv.innerHTML = '<span class="info">‚è≥ Lade training_logs.json...</span>';
                resultDiv.textContent = 'L√§dt...';

                const response = await fetch('data/training_logs.json?t=' + Date.now());

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();

                const summary = {
                    'Timesteps Count': data.timesteps?.length || 0,
                    'First Timestep': data.timesteps?.[0] || 'N/A',
                    'Last Timestep': data.timesteps?.[data.timesteps.length - 1] || 'N/A',
                    'Rewards Count': data.mean_reward?.length || 0,
                    'First Reward': data.mean_reward?.[0]?.toFixed(2) || 'N/A',
                    'Last Reward': data.mean_reward?.[data.mean_reward.length - 1]?.toFixed(2) || 'N/A',
                    'Best Reward': Math.max(...(data.mean_reward || [0])).toFixed(2)
                };

                resultDiv.innerHTML = `<span class="success">‚úÖ Daten erfolgreich geladen!</span>\n\n` +
                    JSON.stringify(summary, null, 2);

                statusDiv.innerHTML = '<span class="success">‚úÖ Alles funktioniert! Das Dashboard sollte die Daten anzeigen.</span>';

            } catch (error) {
                resultDiv.innerHTML = `<span class="error">‚ùå FEHLER:\n${error.message}</span>\n\n` +
                    `M√∂gliche Ursache:\n` +
                    `- Server l√§uft nicht (starte start_server.bat)\n` +
                    `- Falscher Pfad (√∂ffne http://localhost:8000/dashboard/test_data.html)\n` +
                    `- Datei fehlt (f√ºhre: cd training && python reconstruct_from_models.py)`;

                statusDiv.innerHTML = '<span class="error">‚ùå Fehler beim Laden - siehe Details unten</span>';
            }
        }

        // Auto-Test beim Laden
        window.addEventListener('DOMContentLoaded', () => {
            testDataLoad();

            // Test File Existenz
            fetch('data/training_logs.json', { method: 'HEAD' })
                .then(resp => {
                    if (resp.ok) {
                        document.getElementById('file-result').innerHTML =
                            '<span class="success">‚úÖ training_logs.json ist erreichbar</span>';
                    } else {
                        document.getElementById('file-result').innerHTML =
                            `<span class="error">‚ùå HTTP ${resp.status}: Datei nicht gefunden</span>`;
                    }
                })
                .catch(err => {
                    document.getElementById('file-result').innerHTML =
                        `<span class="error">‚ùå Fehler: ${err.message}</span>`;
                });
        });
    </script>
</body>
</html>
